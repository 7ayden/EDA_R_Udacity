Exploration of WA DOH School Exemption Data over 3 School Years by Andrew T. Bauman
========================================================
#Introduction#

Recent news media coverage and my own personal interest inspired me to explore a school vaccination data set for WA state.  WA DOH employees generously assembled 3 data sets for my project for school years 2011-2012, 2012-2013, and 2013-2014.  The 2011-2012 set is the most comprehensive in terms of school covered and relevant fields  Each data set contains an observation about a school.  The 3 data sets were bound into one data set, then explored.  

The initial data and cleaning/assembly of the combined data frame can be found here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/tree/master/EDA_R_FinalProject/EDA_R_FinalProject.Rmd)

Additional cleaning and wrangling can be found here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/blob/master/EDA_R_FinalProject/EDA_R_FinalProject_WADOH_DataFrameWrangle.Rmd)

An initial exploration wherein I make decisions about subsetting data for this RMD is and some additoinal corrections for student enrollment, is here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/blob/master/EDA_R_FinalProject/WADOH_DataExplore.Rmd)


The current state is a rough approach and far from perfect.  I plan to revisit this as I discover additional elements that need cleaning.  I am currently working on a more readable and organized version of the data wrangling which involves piping/chaining the code together, so that changes are easy to make and push to the .rds file called as data for this project.

**Disclaimer:**
While I am a trained scientist, I am not an expert statistician or programmer.  This is a student project.  My data cleaning and wrangling has room for improvement.  As such, please exercise caution and good judgement regarding my observations and conclusions.  **Feedback on any aspect of this project is encouraged and most welcome.**

There are some aspects of vaccination and the spread of disease through populations that are best left to subject matter experts (SMEs).  I consulted CDC publications throughout this analysis and I encourage the reader to do the same.
```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load libraries

library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(GGally)
library(reshape2)
library(tidyr)
library(RColorBrewer)
cb.palette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442",
                    "#0072B2", "#D55E00", "#CC79A7")

```

```{r echo=FALSE, Load_the_Data}

#school vaccine exemption data, reported == "Yes" for WA State, school years 2011-2012, 2012-2013, 2013-2014
vaccReported <- readRDS("data/vaccReported")


#temp convenience
#setwd("Udacity//dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject/")
#save.image("project_pause.RData")
#load("project_pause.RData")
```

``` {r echo = FALSE ,alter_data}
#limit fields
fields <- c("school_year", "school_code", "school_name", "school_type", "school_city","school_state", "school_zip", "school_county", "school_district", "district_code", "enrolled", "total_exemptions", "medical_exempt", "nonmedical_exempt", "exempt_MMR", "percent_exempt", "percent_medical_exempt","percent_nonmedexempt", "percent_exempt_MMR")


vaccReported <- subset(arrange(vaccReported, desc(enrolled)), na.rm = TRUE, select = fields )


```

# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}
#vacc
names(vaccReported)
str(vaccReported)
summary(vaccReported)

#distribution of enrollment
ggplot(aes(x = enrolled), data = vaccReported) + 
  geom_histogram(binwidth = 30,  color = 'black',fill = '#F79420') +
  scale_x_continuous(limits = c(0,5100), breaks = seq(0, 5100, 500))

ggplot(aes(x = enrolled), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  scale_x_log10()


#summary of total exemptions
summary(vaccReported$total_exemptions)
by(vaccReported$total_exemptions, vaccReported$school_year,summary)

summary(vaccReported$percent_exempt)
by(vaccReported$percent_exempt, vaccReported$school_year,summary)


#distribution of total exemptions

ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = 5,  color = 'black',fill = '#F79420') +
  scale_x_continuous(limits = c(0,450), breaks = seq(0, 450, 50))


ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = 5,  color = 'black',fill = '#F79420') +
  scale_x_continuous(limits = c(0,250), breaks = seq(0, 250, 10))


ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = .05,  color = 'black',fill = '#F79420') +
  scale_x_log10()

#total exempt by year

ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = 'red') +
  scale_x_log10() +
  xlab("Log10(Total Exemptions)")


ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(Total Exemptions)")

#percent total exemptions

ggplot(aes(x = percent_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  scale_x_log10()
  
##freqpoly proportion of percent exempt, by county, color = year
ggplot(aes(x = percent_exempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent exempt, by county, color = year
ggplot(aes(x = percent_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()


#explore medical exemptions
summary(vaccReported$medical_exempt)
by(vaccReported$medical_exempt, vaccReported$school_year,summary)

summary(vaccReported$percent_medical_exempt)
by(vaccReported$percent_medical_exempt, vaccReported$school_year,summary)

#medical exempt

ggplot(aes(x = medical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  scale_x_log10() +
  xlab("Log10(medical_exemptions)")

ggplot(aes(x = medical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(medical_exemptions)")

#percent medical exemptions


ggplot(aes(x = percent_medical_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  scale_x_log10()
  
##freqpoly proportion of percent medical exempt, by county, color = year
ggplot(aes(x = percent_medical_exempt, y = ..count../sum(..count..)), data = subset(vaccReported, vaccReported$percent_medical_exempt > 0)) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent medical exempt, by county, color = year
ggplot(aes(x = percent_medical_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

#explore non-medical exemptions
summary(vaccReported$nonmedical_exempt)
by(vaccReported$nonmedical_exempt, vaccReported$school_year,summary)

summary(vaccReported$percent_nonmedexempt)
by(vaccReported$percent_nonmedexempt, vaccReported$school_year,summary)

#non-medical exempt



ggplot(aes(x = nonmedical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  scale_x_log10() +
  xlab("Log10(nonmedical_exemptions)")

ggplot(aes(x = nonmedical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(nonmedical_exemptions)")


#percent non-medical exemptions


ggplot(aes(x = percent_nonmedexempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  scale_x_log10()
  
##freqpoly proportion of percent nonmedical exempt, by county, color = year
ggplot(aes(x = percent_nonmedexempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent nonmedical exempt, by county, color = year
ggplot(aes(x = percent_nonmedexempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()


#MMR exemptions

summary(vaccReported$exempt_MMR)
by(vaccReported$exempt_MMR, vaccReported$school_year,summary)

summary(vaccReported$percent_exempt_MMR)
by(vaccReported$percent_exempt_MMR, vaccReported$school_year,summary)




ggplot(aes(x = exempt_MMR), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  scale_x_log10() 


ggplot(aes(x = exempt_MMR), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() 
  

#percent exempt MMR


ggplot(aes(x = percent_exempt_MMR, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  scale_x_log10()
  
##freqpoly proportion of percent exempt MMR, by county, color = year
ggplot(aes(x = percent_exempt_MMR, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent exempt MMR, by county, color = year
ggplot(aes(x = percent_exempt_MMR, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()


```
```{r temp sandbox}
##top 200
top200_allyears_allpop <- arrange(vaccReported, desc(percent_exempt))[1:200,c("school_year","school_name", "school_county", "school_city","enrolled", "total_exemptions", "percent_exempt")]

#top200_allyears_NLT100 <- arrange(subset(vaccReported, vaccReported$enrolled >= 100), desc(percent_exempt))[1:200,c("school_year","school_name", "school_county", "school_city","enrolled", "total_exemptions", "percent_exempt")]



state_rate <- mean(vaccReported$percent_exempt, na.rm=T)
#state_rate_NLT100 <- mean(vaccReported_NLT100$percent_exempt, na.rm = T)

#summarize(vaccReported_NLT100, Mean_percent_exempt = mean(percent_exempt, na.rm = TRUE))

#summarize(vaccReported_NLT100, Mean_percent_nonmedexempt = mean(percent_nonmedexempt, na.rm = TRUE))

#boxplot to compare means/medians NLT100 vs reg



##total percent exempt all schools

##state level by year
ggplot(vaccReported, aes(x = school_state, y = percent_exempt)) +
  geom_boxplot() +
  geom_jitter(alpha = .5, aes(size = enrolled, color = enrolled)) +
  facet_wrap(~school_year) +
  scale_color_gradientn(colours = c("red", "orange", "yellow")) #fix color scheme and do plots where outier pops are removed

#year level by county
ggplot(vaccReported, aes(x = school_year, y = percent_exempt)) +
  geom_boxplot(outlier.colour = "red") +
  facet_wrap(~school_county)

##total percent exempt all schools

##state level by year
#ggplot(vaccReported_NLT100, aes(x = school_state, y = percent_exempt)) +
 # geom_boxplot() +
  #geom_jitter(alpha = .5, aes(size = enrolled, color = enrolled)) +
  #facet_wrap(~school_year) +
  #scale_color_gradientn(colours = c("red", "orange", "yellow")) #fix color scheme and do plots where outier pops are removed

##year level by county
#ggplot(vaccReported_NLT100, aes(x = school_year, y = percent_exempt)) +
 # geom_boxplot(outlier.colour = "red") +
  #facet_wrap(~school_county)


ggplot(aes(x = percent_exempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()



#exemption rate vs enrollment
p = ggplot(vaccReported, aes(x = enrolled, y = percent_exempt)) + 
  geom_point(alpha = .4, aes(color = "red"))  
  
p1 = p +  geom_line(alpha = .5,stat = 'summary',fun.y = mean, linetype = 1, color = "black", size = 1) 

p2 = p1 + facet_wrap(~school_year)

p3 = p1 + geom_vline(xintercept = 2500, color="orange", size = 1) +
     geom_vline(xintercept = 2000, color="orange", size = 1)  
  

p4 = p3 + scale_x_continuous(limits = c(0, 2000), breaks = seq(0,2000,50))

p5 = p4 + geom_vline(xintercept = 100, color="orange", size = 1) +
  geom_vline(xintercept = 25, color="orange", size = 1)
  

p1
p2
p3
p4
p5




```

# Univariate Analysis

### What is the structure of your dataset?
My data set contains 6696 observat

### What is/are the main feature(s) of interest in your dataset?

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

### Did you create any new variables from existing variables in the dataset?

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?



# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection


# References
