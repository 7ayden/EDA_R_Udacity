Exploration of WA DOH School Exemption Data over 3 School Years by Andrew T. Bauman
========================================================
#Introduction#

Recent news media coverage and my own personal interest inspired me to explore a school vaccination data set for WA state.  WA DOH employees generously assembled 3 data sets for my project for school years 2011-2012, 2012-2013, and 2013-2014.  The 2011-2012 set is the most comprehensive in terms of school covered and relevant fields  Each data set contains an observation about a school.  The 3 data sets were bound into one data set, then explored.  

The initial data and cleaning/assembly of the combined data frame can be found here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/tree/master/EDA_R_FinalProject/EDA_R_FinalProject.Rmd)

Additional cleaning and wrangling can be found here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/blob/master/EDA_R_FinalProject/EDA_R_FinalProject_WADOH_DataFrameWrangle.Rmd)

An initial exploration wherein I make decisions about subsetting data for this RMD is and some additoinal corrections for student enrollment, is here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/blob/master/EDA_R_FinalProject/WADOH_DataExplore.Rmd)


The current state is a rough approach and far from perfect.  I plan to revisit this as I discover additional elements that need cleaning.  I am currently working on a more readable and organized version of the data wrangling which involves piping/chaining the code together, so that changes are easy to make and push to the .rds file called as data for this project.

**Disclaimer:**
While I am a trained scientist, I am not an expert statistician or programmer.  This is a student project.  My data cleaning and wrangling has room for improvement.  As such, please exercise caution and good judgement regarding my observations and conclusions.  **Feedback on any aspect of this project is encouraged and most welcome.**

There are some aspects of vaccination and the spread of disease through populations that are best left to subject matter experts (SMEs).  I consulted CDC publications throughout this analysis and I encourage the reader to do the same.
```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load libraries

library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(GGally)
library(reshape2)
library(tidyr)
library(RColorBrewer)
library(scales)
cb.palette <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442",
                    "#0072B2", "#D55E00", "#CC79A7")

```

```{r echo=FALSE, Load_the_Data}

#school vaccine exemption data, reported == "Yes" for WA State, school years 2011-2012, 2012-2013, 2013-2014
vaccReported <- readRDS("data/vaccReported")


#temp convenience
#setwd("Udacity//dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject/")
#save.image("project_pause.RData")
#load("project_pause.RData")
```
##Alter Data##

* Select fields from WA DOH 2011 - 2012, 2012-2013, and 2013 - 2014 School Year data set.*
* Subset or reported only*
* Subset by enrollement 10 - 2500 students all school years*
* Subset by enrollment 10 - 2500 students most recent school year (2013)*
* Subset by enrollment 100 - 2500 students*
``` {r echo = FALSE ,alter_data}
#limit fields
fields <- c("school_year", "school_code", "school_name", "school_type", "school_city","school_state", "school_zip", "school_county", "school_district", "district_code", "enrolled", "total_exemptions", "medical_exempt", "nonmedical_exempt", "exempt_MMR", "percent_exempt", "percent_medical_exempt","percent_nonmedexempt", "percent_exempt_MMR")


vaccReported <- subset(arrange(vaccReported, desc(enrolled)), na.rm = TRUE, select = fields 
                       )
vaccReported_NLT_10_NGT_2500 <- subset(vaccReported,vaccReported$enrolled >= 10 & vaccReported$enrolled <= 2500) %>%
  arrange(desc(percent_exempt))

vaccReported_NLT_10_NGT_2500_2013 <- subset(vaccReported_NLT_10_NGT_2500, school_year == "2013")

vaccReported_NLT_100_NGT_2500 <- subset(vaccReported,vaccReported$enrolled >= 100 & vaccReported$enrolled <= 2500) %>%
  arrange(desc(percent_exempt))


brks <- c(1, 5, 10, 50, 100, 500, 1000, 5000, 10000)

brks2 <- c(.25,.5, 1, 2.5, 5, 10, 15, 25, 50, 75, 100)

brks3 <- c(.1,.25,.5,1,5,10,50)

```

# Univariate Plots Section

##Distribution of enrolled students##
```{r echo=FALSE, dist_enrollment}
#vacc
names(vaccReported)
str(vaccReported)
summary(vaccReported)

#distribution of enrollment
ggplot(aes(x = enrolled), data = vaccReported) + 
  geom_histogram(binwidth = 30,  color = 'black',fill = '#F79420') +
  scale_x_continuous(limits = c(0,5100), breaks = seq(0, 5100, 500))
```

This is a long tailed distribution, a feature exhibited by most distributions in this data set.  Log transformations are performed to visualize the data.

```{r echo = FALSE, dist_enrollment_cont}


ggplot(aes(x = enrolled), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  scale_x_log10(breaks = brks) +
  xlab("Log10(enrolled)")

```

* Range:  1 - 5076*
* Most of the data falls between ~ 100 - 1000 students per school*

##Distribution of total exemptions##
```{r echo=FALSE, total_exemptions}


#summary of total exemptions
summary(vaccReported$total_exemptions)
by(vaccReported$total_exemptions, vaccReported$school_year,summary)

#total exemption rate
summary(vaccReported$percent_exempt)
by(vaccReported$percent_exempt, vaccReported$school_year,summary)


#distribution of total exemptions

ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = 5,  color = 'black',fill = '#F79420') +
  scale_x_continuous(limits = c(0,450), breaks = seq(0, 450, 50))


ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = log(1.2),  color = 'black',fill = '#F79420') +
  scale_x_log10(breaks = brks) +
  xlab("Log10(Total Exemptions)")
  

#total exempt by year

ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth =log(1.25),  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10(breaks = brks) +
  xlab("Log10(Total Exemptions)")



#percent total exemptions

ggplot(aes(x = percent_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  scale_x_log10(breaks = brks2)
  
##freqpoly proportion of percent exempt, by county, color = year
ggplot(aes(x = percent_exempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = log(1.25), aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()



##freqpoly density of percent exempt, by county, color = year
ggplot(aes(x = percent_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

#plot select counties to compare to King
  
ggplot(aes(x = percent_exempt, y = ..density..), data = subset(vaccReported, school_county == "KING" | school_county == "FERRY" | school_county == "CLARK" | school_county == "PIERCE" | school_county == "SAN JUAN")) +
  geom_freqpoly(binwidth = .5, aes(color = school_county, size = 1.25, alpha = .5)) +
  scale_x_log10()

```

* Range: 0 - 436*
* Rate:  0 - 100%, ~ 6.6% mean for all 3 school years*
* The highest density data is from ~ 10 - 75 students per school*
* Year to year distributions are similiar for total and rate*
* most schools fall into a rate range of 2-25%*
* King County has the highest proportion of exemptions*
* There appears to be some smaller counties (i.e. Ferry, San Juan) and others with more density at higher exemption rates than King and Pierce county (most populous counties in WA)*


**Note:**  Higher exemption rates of ~ > 50% appear to be associated with lower levels of enrollment (< 100 students).  This will be investigated in the bivariate section.



##Medical Exemptions##
```{r echo=FALSE, medical_exemptions}

#explore medical exemptions
summary(vaccReported$medical_exempt)
by(vaccReported$medical_exempt, vaccReported$school_year,summary)

#explore percent medical exempt
summary(vaccReported$percent_medical_exempt)
by(vaccReported$percent_medical_exempt, vaccReported$school_year,summary)



#medical exempt

ggplot(aes(x = medical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  scale_x_log10(breaks = brks) +
  xlab("Log10(medical_exemptions)")

ggplot(aes(x = medical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10(breaks = brks) +
  xlab("Log10(medical_exemptions)")

#percent medical exemptions

ggplot(aes(x = percent_medical_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = log(1.25)) +
  scale_x_log10(breaks = brks3)



ggplot(aes(x = percent_medical_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = log(1.25), aes(color = school_year)) +
  scale_x_log10(breaks = brks3)
  
##freqpoly proportion of percent medical exempt, by county, color = year
ggplot(aes(x = percent_medical_exempt, y = ..count../sum(..count..)), data = subset(vaccReported, vaccReported$percent_medical_exempt > 0)) +
  geom_freqpoly(binwidth = log(1.25), aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent medical exempt, by county, color = year
ggplot(aes(x = percent_medical_exempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = log(1.25), aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

```

* Range of 0-214 exemptions*
* Substantial rate increase from 2012 -> 2013*
* Most schools have 1-10 students with medical exemptions*
* The rate range is ` 0 -33% with most schols falling between ~0.1 and 5%*
* The mean rate rose from .55% to 1.08% from 2011 -> 2013*
* Overall distribution of rate shifts towards higher rates from 2011 -> 2013*
* King County*
  * highest proportion*
  * substantial shift to higer rates from 2011 -> 2013*
  * there is a distinct spike at > 10%*
* Columbia county has not reported any medical exemptions for any year*

##Non-medical Exemptions##
```{r echo=FALSE, nonmedical_exemptions}
#explore non-medical exemptions
summary(vaccReported$nonmedical_exempt)
by(vaccReported$nonmedical_exempt, vaccReported$school_year,summary)

summary(vaccReported$percent_nonmedexempt)
by(vaccReported$percent_nonmedexempt, vaccReported$school_year,summary)

#non-medical exempt

ggplot(aes(x = nonmedical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  scale_x_log10(breaks = brks2) +
  xlab("Log10(nonmedical_exemptions)")

ggplot(aes(x = nonmedical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(nonmedical_exemptions)")


#percent non-medical exemptions

ggplot(aes(x = percent_nonmedexempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  scale_x_log10(breaks = brks3)
  
##freqpoly proportion of percent nonmedical exempt, by county, color = year
ggplot(aes(x = percent_nonmedexempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent nonmedical exempt, by county, color = year
ggplot(aes(x = percent_nonmedexempt, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

```

* Range 0 - 330 with most schools haveing ~8-75 nonmedical exempt students*
* Mean fell by ~ 5 students per school 2011 -> 2013*
* Rate of 0 -100% with most schools at ~ 1 - 20% nonmedical exempt*
* No substantial change in mean rate (~6%) from 2011 -> 2013*
* King County has the largest proportion of nonmedical exempt*
* Ferry and San Juan counties distributiion is at a higher % than King County*

##MMR Exemptions##
```{r echo=FALSE, MMR_exemptions}


#MMR exemptions

summary(vaccReported$exempt_MMR)
by(vaccReported$exempt_MMR, vaccReported$school_year,summary)

summary(vaccReported$percent_exempt_MMR)
by(vaccReported$percent_exempt_MMR, vaccReported$school_year,summary)


ggplot(aes(x = exempt_MMR), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  scale_x_log10(breaks = brks) 


ggplot(aes(x = exempt_MMR), data = vaccReported) + 
  geom_histogram(binwidth = log(1.25),  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() 
  

#percent exempt MMR

ggplot(aes(x = percent_exempt_MMR, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = log(1.25), aes(color = school_year)) +
  scale_x_log10(breaks = brks3)
  
##freqpoly proportion of percent exempt MMR, by county, color = year
ggplot(aes(x = percent_exempt_MMR, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

##freqpoly density of percent exempt MMR, by county, color = year
ggplot(aes(x = percent_exempt_MMR, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

ggplot(aes(x = percent_exempt_MMR, y = ..density..), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()



```

* Range 0-269 with most schools haveing 3 - 40 MMR exempt students*
* Rate 0 -100% with most schools falling between ~0.5 - 20%*
* No substntial change in total mean or mean rate from 2011 -> 2013*
* King County has the largest proportion of nonmedical exempt*
* Ferry and San Juan counties distributiion is at a higher % than King County*

##Explore Exemption Types##

Gather terms for exemption type (melt) the dataframe, the calculate the % of total exemptions that are of a particular type (medical or non-medical)  While this is not a tidy data frame it is a convenient way to look at observations by exemption type.  I am using this to develop a better understanding of the propotion of exemptions that are non-medical.
```{r echo=FALSE, exemption_types}

melt <- gather(vaccReported_NLT_10_NGT_2500,exemption_type,exemptions,medical_exempt, nonmedical_exempt)

str(melt)
names(melt)
summary(melt)

#add percent by exemption type
melt$percent_exemption_type <- round((melt$exemptions/melt$total_exemptions)*100,digits = 2)

str(melt)
names(melt)
summary(melt)
ggplot(data = melt, aes(x = percent_exemption_type, y = ..density..)) +
  geom_freqpoly(binwidth = log(1.25),aes(color = exemption_type)) +
  facet_wrap(school_type ~ school_year) +
  scale_x_log10()

ggplot(data = melt, aes(x = percent_exemption_type, y = ..count../sum(..count..))) +
  geom_freqpoly(binwidth = log(1.25),aes(color = exemption_type)) +
  facet_wrap(school_type ~ school_year) +
  scale_x_log10()

```

Public and private schools have similiar distributions and rates of both types of exemptions, for all three school years.  Public schools have a larger proportion of exempitons of both types.


```{r temp_sandbox}






### by specific type
#by.mwc <- data.sub %>%  group_by(MWC) %>% summarize(Mean.PBE = round(mean(Exempt, na#.rm
#=TRUE), 2), Median.PBE = round(median(Exempt, na.rm=TRUE), 2), Max.PBE = round(max
#(Exempt, na.rm=TRUE), 2), Min.PBE = round(min(Exempt, na.rm=TRUE), 2), Schools=n(), #Students=sum(enrollment, na.rm=TRUE)) %>% na.omit() %>% arrange(desc(Mean.PBE))



#state_rate <- mean(vaccReported$percent_exempt, na.rm=T)
#state_rate_NLT100 <- mean(vaccReported_NLT100$percent_exempt, na.rm = T)

#summarize(vaccReported_NLT100, Mean_percent_exempt = mean(percent_exempt, na.rm = TRUE))

#summarize(vaccReported_NLT100, Mean_percent_nonmedexempt = mean(percent_nonmedexempt, na.rm #= TRUE))

#boxplot to compare means/medians NLT100 vs reg



##total percent exempt all schools

##state level by year
ggplot(vaccReported, aes(x = school_state, y = percent_exempt)) +
  geom_boxplot() +
  geom_jitter(alpha = .5, aes(size = enrolled, color = enrolled)) +
  facet_wrap(~school_year) +
  scale_color_gradientn(colours = c("red", "orange", "yellow")) #fix color scheme and do plots where outier pops are removed

#year level by county
ggplot(vaccReported, aes(x = school_year, y = percent_exempt)) +
  geom_boxplot(outlier.colour = "red") +
  facet_wrap(~school_county)

##total percent exempt all schools

##state level by year
#ggplot(vaccReported_NLT100, aes(x = school_state, y = percent_exempt)) +
 # geom_boxplot() +
  #geom_jitter(alpha = .5, aes(size = enrolled, color = enrolled)) +
  #facet_wrap(~school_year) +
  #scale_color_gradientn(colours = c("red", "orange", "yellow")) #fix color scheme and do plots where outier pops are removed

##year level by county
#ggplot(vaccReported_NLT100, aes(x = school_year, y = percent_exempt)) +
 # geom_boxplot(outlier.colour = "red") +
  #facet_wrap(~school_county)






#exemption rate vs enrollment
p = ggplot(vaccReported, aes(x = enrolled, y = percent_exempt)) + 
  geom_point(alpha = .4, aes(color = "red"))  
  
p1 = p +  geom_line(alpha = .5,stat = 'summary',fun.y = mean, linetype = 1, color = "black", size = 1) 

p2 = p1 + facet_wrap(~school_year)

p3 = p1 + geom_vline(xintercept = 2500, color="orange", size = 1) +
     geom_vline(xintercept = 2000, color="orange", size = 1)  
  

p4 = p3 + scale_x_continuous(limits = c(0, 2000), breaks = seq(0,2000,50))

p5 = p4 + geom_vline(xintercept = 100, color="orange", size = 1) +
  geom_vline(xintercept = 25, color="orange", size = 1)
  

p1
p2
p3
p4
p5




```

# Univariate Analysis

### What is the structure of your dataset?
My data set contains 6696 observations of 19 variables.

### What is/are the main feature(s) of interest in your dataset?
Number of exemptions per school: total, by type (medical and non-medical), and MMR.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
School enrollment and location grouping (country, district, city, zip code)

### Did you create any new variables from existing variables in the dataset?
I created % of each total and each exemption using the number respective to the exemtion and enrollment, for each schools.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
I was suprised to see that two of the smaller counties, Ferry and San Juan had distributions shifted to higher percent of all exemptions than King County.  The narrative in the Seattle media led me to believe that the highest exemption rates would be observed in King County and the Seattle area in general.  I was also surprised to find the public and private schools have similiar distribuions, albeit different proportions, respective to exemption type.  This is the case on a proportion basis, but not for rate.  However, the schools in these counties tend to be much smaller so the rates shift dramatically per exempt student.  There was substantial tidying of the orignal data sets as per the github links in the introduction.  I extracted a subset of the data consisting of only schools that reported exemptions for the three schools years.  This elminated ~ 1200 observations but was necessary since non-reporting schools are missing all exemption values and typcially enrollment as well.



# Bivariate Plots Section

##Group by Attribute##
Group observations by county, city, zip, etc. for the most recent school year, 2013-2014.  
```{r echo=FALSE, group_by_attribute}

names(vaccReported_NLT_10_NGT_2500_2013)

#explain any enrollment cutoffs and gie str, summ, and names for data

#change nonmedical exempt to 20 and then resave .rds
inspect <- vaccReported[vaccReported$school_name == "Tacoma Waldorf School",]

#going to do for 2013 (most recent year) top 10 by mean nonmedical exempt for county, then withing that county, district, then city, then withing city the zip code.  Then get count of schools in each that are over 10% total exempt, and 5% MMR exempt.  Maybe save some of this for bivariate.  I'm thinking that in bivariate I can look at schools or zones over the MMR threshold and then determine what proportion of the total exemptions are from medical and which are from nonmedical in those zones.  that could be a final plot, the point being is taht choice is pushing it over.

#group by county

by_county_exempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county) %>% 
  summarize(mean_percent_exempt = round(mean(percent_exempt, na.rm=TRUE), 2), 
            median_percent_exempt = round(median(percent_exempt, na.rm=TRUE), 2), 
            max_percent_exempt = round(max(percent_exempt, na.rm=TRUE), 2), 
            min_percent_exempt = round(min(percent_exempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>%
  na.omit() %>% 
  arrange(desc(mean_percent_exempt))

by_county_nonmedexempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county) %>% 
  summarize(mean_percent_nonmedexempt = round(mean(percent_nonmedexempt, na.rm=TRUE), 2), 
            median_percent_nonmedexempt = round(median(percent_nonmedexempt, na.rm=TRUE), 2), 
            max_percent_nonmedexempt = round(max(percent_nonmedexempt, na.rm=TRUE), 2), 
            min_percent_nonmedexempt = round(min(percent_nonmedexempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_nonmedexempt))


by_county_medexempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county) %>% 
  summarize(mean_percent_nonmedexempt = round(mean(percent_nonmedexempt, na.rm=TRUE), 2), 
            median_percent_nonmedexempt = round(median(percent_nonmedexempt, na.rm=TRUE), 2), 
            max_percent_nonmedexempt = round(max(percent_nonmedexempt, na.rm=TRUE), 2), 
            min_percent_nonmedexempt = round(min(percent_nonmedexempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_nonmedexempt))


by_county_medexempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county) %>% 
  summarize(mean_percent_medical_exempt = round(mean(percent_medical_exempt, na.rm=TRUE), 2), 
            median_percent_medical_exempt = round(median(percent_medical_exempt, na.rm=TRUE), 2), 
            max_percent_medical_exempt = round(max(percent_medical_exempt, na.rm=TRUE), 2), 
            min_percent_medical_exempt = round(min(percent_medical_exempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_medical_exempt))


by_county_MMR <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county) %>% 
  summarize(mean_percent_exempt_MMR = round(mean(percent_exempt_MMR, na.rm=TRUE), 2), 
            median_percent_exempt_MMR = round(median(percent_exempt_MMR, na.rm=TRUE), 2), 
            max_percent_exempt_MMR = round(max(percent_exempt_MMR, na.rm=TRUE), 2), 
            min_percent_exempt_MMR = round(min(percent_exempt_MMR, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_exempt_MMR))

#merge county groups and sort by students enrolled

county_group <- inner_join(by_county_medexempt, by_county_MMR, by = "school_county") %>%
  inner_join(by_county_exempt, by = "school_county") %>%
  select(-c(students.x, schools.x, students.y, schools.y)) %>%
  arrange(desc(students))



names(county_group)
summary(county_group)
str(county_group)


#group by county, school_type

by_county_exempt_type <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county,school_type) %>% 
  summarize(mean_percent_exempt = round(mean(percent_exempt, na.rm=TRUE), 2), 
            median_percent_exempt = round(median(percent_exempt, na.rm=TRUE), 2), 
            max_percent_exempt = round(max(percent_exempt, na.rm=TRUE), 2), 
            min_percent_exempt = round(min(percent_exempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>%
  na.omit() %>% 
  arrange(desc(mean_percent_exempt))

by_county_nonmedexempt_type <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county, school_type) %>% 
  summarize(mean_percent_nonmedexempt = round(mean(percent_nonmedexempt, na.rm=TRUE), 2), 
            median_percent_nonmedexempt = round(median(percent_nonmedexempt, na.rm=TRUE), 2), 
            max_percent_nonmedexempt = round(max(percent_nonmedexempt, na.rm=TRUE), 2), 
            min_percent_nonmedexempt = round(min(percent_nonmedexempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_nonmedexempt))


by_county_medexempt_type <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county, school_type) %>% 
  summarize(mean_percent_nonmedexempt = round(mean(percent_nonmedexempt, na.rm=TRUE), 2), 
            median_percent_nonmedexempt = round(median(percent_nonmedexempt, na.rm=TRUE), 2), 
            max_percent_nonmedexempt = round(max(percent_nonmedexempt, na.rm=TRUE), 2), 
            min_percent_nonmedexempt = round(min(percent_nonmedexempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_nonmedexempt))


by_county_medexempt_type <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county,school_type) %>% 
  summarize(mean_percent_medical_exempt = round(mean(percent_medical_exempt, na.rm=TRUE), 2), 
            median_percent_medical_exempt = round(median(percent_medical_exempt, na.rm=TRUE), 2), 
            max_percent_medical_exempt = round(max(percent_medical_exempt, na.rm=TRUE), 2), 
            min_percent_medical_exempt = round(min(percent_medical_exempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_medical_exempt))


by_county_MMR_type <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_county, school_type) %>% 
  summarize(mean_percent_exempt_MMR = round(mean(percent_exempt_MMR, na.rm=TRUE), 2), 
            median_percent_exempt_MMR = round(median(percent_exempt_MMR, na.rm=TRUE), 2), 
            max_percent_exempt_MMR = round(max(percent_exempt_MMR, na.rm=TRUE), 2), 
            min_percent_exempt_MMR = round(min(percent_exempt_MMR, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_exempt_MMR))

#merge county/type groups and sort by students enrolled

county_group_type <- inner_join(by_county_medexempt_type, by_county_MMR_type, by = c("school_county","school_type")) %>%
  inner_join(by_county_exempt_type, by = c("school_county","school_type")) %>%
  select(-c(students.x, schools.x, students.y, schools.y)) %>%
  arrange(desc(students))



names(county_group_type)
summary(county_group_type)
str(county_group_type)

#rm(by_county_exempt_type,by_county_medexempt_type,by_county_nonmedexempt_type,by_county_MMR_type)


  



by_city_exempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_city) %>% 
  summarize(mean_percent_exempt = round(mean(percent_exempt, na.rm=TRUE), 2), 
            median_percent_exempt = round(median(percent_exempt, na.rm=TRUE), 2), 
            max_percent_exempt = round(max(percent_exempt, na.rm=TRUE), 2), 
            min_percent_exempt = round(min(percent_exempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_exempt))

by_city_nonmedexempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_city) %>% 
  summarize(mean_percent_nonmedexempt = round(mean(percent_nonmedexempt, na.rm=TRUE), 2), 
            median_percent_nonmedexempt = round(median(percent_nonmedexempt, na.rm=TRUE), 2), 
            max_percent_nonmedexempt = round(max(percent_nonmedexempt, na.rm=TRUE), 2), 
            min_percent_nonmedexempt = round(min(percent_nonmedexempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_nonmedexempt))


by_zip_exempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_zip) %>% 
  summarize(mean_percent_exempt = round(mean(percent_exempt, na.rm=TRUE), 2), 
            median_percent_exempt = round(median(percent_exempt, na.rm=TRUE), 2), 
            max_percent_exempt = round(max(percent_exempt, na.rm=TRUE), 2), 
            min_percent_exempt = round(min(percent_exempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  arrange(desc(mean_percent_exempt))

by_zip_nonmedexempt <- vaccReported_NLT_10_NGT_2500_2013 %>%  group_by(school_zip) %>% 
  summarize(mean_percent_nonmedexempt = round(mean(percent_nonmedexempt, na.rm=TRUE), 2), 
            median_percent_nonmedexempt = round(median(percent_nonmedexempt, na.rm=TRUE), 2), 
            max_percent_nonmedexempt = round(max(percent_nonmedexempt, na.rm=TRUE), 2), 
            min_percent_nonmedexempt = round(min(percent_nonmedexempt, na.rm=TRUE), 2), 
            schools=n(), 
            students=sum(enrolled, na.rm=TRUE)) %>% 
  na.omit() %>% 
  filter(students >=500) %>%
  arrange(desc(mean_percent_nonmedexempt))
names(vaccReported) 
```
```{r echo=FALSE, Bivariate_Plots}

#total exemptions vs. enrollment
##
ggplot(data = vaccReported, aes(x = enrolled, y = total_exemptions)) +
  geom_line(alpha = .25,aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = subset(vaccReported,enrolled <= 2500), aes(x = enrolled, y = total_exemptions)) +
  geom_line(alpha = .25,aes(color = school_year)) +
  geom_smooth()

###
ggplot(data = subset(vaccReported,enrolled <= 2000), aes(x = enrolled, y = total_exemptions)) +
  geom_line(alpha = .25,aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

##
ggplot(data = vaccReported_NLT_10_NGT_2500_2013, aes(x = enrolled, y = total_exemptions)) +
  geom_line(alpha = .5) +
  geom_smooth()


#exemption rate vs enrollment
##
ggplot(vaccReported, aes(x = enrolled, y = percent_exempt)) + 
  geom_point(alpha = .4, color = 'red')  +  
  geom_line(alpha = .5,stat = 'summary',fun.y = mean, linetype = 1, color = "black", size = 1) +
  scale_x_continuous(limits = c(0, 2000), breaks = seq(0,2000,250))

ggplot(data = vaccReported, aes(x = enrolled, y = percent_medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = enrolled, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = enrolled, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

#exemption rates vs. total exemptions

##
ggplot(data = vaccReported, aes(x = total_exemptions, y = percent_medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = total_exemptions, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = total_exemptions, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()



#specific exemptions vs. enrollment
##
ggplot(data = vaccReported, aes(x = enrolled, y = medical_exempt )) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = enrolled, y = nonmedical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = enrolled, y = exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

#specific exemptions vs. total exemptions
##
ggplot(data = vaccReported, aes(x = total_exemptions, y = medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = total_exemptions, y = nonmedical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()
##
ggplot(data = vaccReported, aes(x = total_exemptions, y = exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

#specific exemption rates vs. total exemption rate
##
ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

##
ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

#specific exemption rates vs. exemption rate for data subset enrolled NLT 100 NGT 2500
##
ggplot(data = vaccReported_NLT_100_NGT_2500, aes(x = percent_exempt, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()


ggplot(data = vaccReported_NLT_100_NGT_2500, aes(x = percent_exempt, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth()

ggplot(data = county_group, aes(x = students, y = mean_percent_exempt)) +
  geom_line() +
  geom_point() +
  geom_smooth()

#exemptions by school year
ggplot(data = vaccReported, aes(x = school_year, y = total_exemptions)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_year, y = medical_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_year, y = nonmedical_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_year, y = exempt_MMR)) +
  geom_boxplot()



#exemptions by school type

ggplot(data = vaccReported, aes(x = school_type, y = total_exemptions)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_type, y = medical_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_type, y = nonmedical_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_type, y = exempt_MMR)) +
  geom_boxplot()

#exemption rates by school year

ggplot(data = vaccReported, aes(x = school_year, y = percent_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_year, y = percent_medical_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_year, y = percent_nonmedexempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_year, y = percent_exempt_MMR)) +
  geom_boxplot()

#exemption rates by school type

ggplot(data = vaccReported, aes(x = school_type, y = percent_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_type, y = percent_medical_exempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_type, y = percent_nonmedexempt)) +
  geom_boxplot()

ggplot(data = vaccReported, aes(x = school_type, y = percent_exempt_MMR)) +
  geom_boxplot()

#rate by rate

ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_exempt_MMR)) +
  geom_line() +
  geom_smooth()

ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_medical_exempt)) +
  geom_line() +
  geom_smooth()

ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_nonmedexempt)) +
  geom_line() +
  geom_smooth()

ggplot(data = vaccReported, aes(x = percent_nonmedexempt, y = percent_medical_exempt)) +
  geom_line() +
  geom_smooth

ggplot(data = vaccReported, aes(x = percent_medical_exempt, y = percent_exempt_MMR)) +
  geom_line() +
  geom_smooth()

ggplot(data = vaccReported, aes(x = percent_nonmedexempt, y = percent_exempt_MMR)) +
  geom_line() +
  geom_smooth()


namez
































```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}
###
ggplot(data = vaccReported, aes(x = total_exemptions, y = percent_medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = total_exemptions, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = total_exemptions, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))


ggplot(data = vaccReported, aes(x = enrolled, y = percent_medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = enrolled, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = enrolled, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = enrolled, y = medical_exempt )) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = enrolled, y = nonmedical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = enrolled, y = exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))


###
ggplot(data = vaccReported, aes(x = total_exemptions, y = medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = total_exemptions, y = nonmedical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))
###
ggplot(data = vaccReported, aes(x = total_exemptions, y = exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_medical_exempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

###
ggplot(data = vaccReported, aes(x = percent_exempt, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))
###
ggplot(data = vaccReported_NLT_100_NGT_2500, aes(x = percent_exempt, y = percent_nonmedexempt)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))


ggplot(data = vaccReported_NLT_100_NGT_2500, aes(x = percent_exempt, y = percent_exempt_MMR)) +
  geom_line(alpha = .5, aes(color = school_year)) +
  geom_smooth(aes(color = school_year))

ggplot(data = county_group, aes(x = students, y = mean_percent_exempt)) +
  geom_line() +
  geom_point() +
  geom_smooth()
```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection


# References
