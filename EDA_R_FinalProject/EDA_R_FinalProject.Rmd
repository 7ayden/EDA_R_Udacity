---
title: "Udacity EDA R Final Project"
author: "Andrew Thomas Bauman"
date: "Tuesday, February 10, 2015"
output: html_document
---

#Introduction#

Recent news media coverage and my own personal interest inspired me to explore a school vaccination data set for WA state.  WA DOH employees generously assembled 3 data sets for my project for school years 2011-2012, 2012-2013, and 2013-2014.  The 2011-2012 set is the most comprehensive in terms of school covered and relavant fields.  I will use the following approach:

- Align 2012 and 2013 data with 2011 data, clean, and homogenize
- Tidy the data
- Concatonate the data
- Merge with demographic data
- Explore the data

###Set Path and Load Libraries###

```{r setpath}
setwd("~/Udacity/dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject")
```

```{r load libraries}
library(RSocrata) #to access socrata data
library(ggplot2)
library(gridExtra)
library(dplyr)
library(alr3)
library(GGally)
library(reshape2)
library(acs) #to access census data
library(tidyr) #bare bones data tidying library

```

###Load WA DOH Data Sets###

Named data sets based on starting year of school year.  That is also how the year variable was assigned.  So 2011 referese to the school year (SY) 2011-2012

```{r load school vaccination exemption data sets}

#WA DOH SY 2011-2012 K-12
doh_k12_2011<- read.csv('~/Udacity/dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject/data/WA_Vacc_K12_2011.csv')

#WA DOH SY 2012-2013 K-12
doh_k12_2012<- read.csv('~/Udacity/dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject/data/WA_Vacc_K12_2012.csv')

#WA doh SY 2013-2014 K-12
doh_k12_2013<- read.csv('~/Udacity/dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject/data/WA_Vacc_K12_2013.csv')
```
###Data Audit###
Most of the audit was done through simple visual inspection.  A few things stood out already, that year was missing from 2012 and 2013, and that the 2012 data had a source column which I don't intend to use.  These were easy add and drops.  I would like to align the geographic information.  The 2012 and 2013 geo info is not as comprehensive as 2011.  I will use the school code to merge all the geo information, that way everything should align and the same strings and values should exist for all schools.  I will use this as a general strategy (referencing the 2011 info) rather than trying to homogenize in other ways.  

```{r Initial Data Audit}

```

###Align Columns to 2011 Set###
Initial cleaning etc. may be clunky and manual.  I intend to semi-automate this with a pipeline prior to project completion.

```{r align to 2011 part 1, simple}
#add Year
doh_k12_2012$Year = 2012
doh_k12_2013$Year= 2013

#drop Data.Source
doh_k12_2012$Data.Source <- NULL

#rename 2013 School Code
names(doh_k12_2013)[names(doh_k12_2013) == 'School.Building.Code'] <- 'School.Code'

#drop 2012 K.12.Number.Complete
doh_k12_2012$K.12.Number.Complete <- NULL

```

###Align School and District information to 2011 with a Merge###
- drop school and district info columns that are indpendent of school year in 2012 and 2013 except school code
- merge subset of 2011 on district code

**Important Question**

Are there schools unique to 2012 or 2013?  I need to inspect this to determine if they are worth holding on to and getting geo info.

####School Code Audit####
Going to try subset on this.  I will subset 2012 and 2013 on those school codes != to 2011, if any.  Using the %in% operator and subsetting on False (not in 2011). 
```{r School Code Audit}
#2012 Unique School Code relative to 2011
schoolcode_2012_unique_2011<- subset(doh_k12_2012, doh_k12_2012$School.Code %in% doh_k12_2011$School.Code == F)

  
#2013 Unique School Code relative to 2011
schoolcode_2013_unique_2011<- subset(doh_k12_2013, doh_k12_2013$School.Code %in% doh_k12_2011$School.Code == F)

#2011 unique school Code relative to 2012 and 2013
schoolcode_2011_unique<- subset(doh_k12_2011, (doh_k12_2011$School.Code %in% doh_k12_2012$School.Code == F) & (doh_k12_2011$School.Code %in% doh_k12_2013$School.Code == F))


#2012 unique school code relative to 2011 and 2013
schoolcode_2012_unique<- subset(doh_k12_2012, (doh_k12_2012$School.Code %in% doh_k12_2011$School.Code == F) & (doh_k12_2012$School.Code %in% doh_k12_2013$School.Code == F))

#2013 unique school code relative to 2011 and 2012
schoolcode_2013_unique<- subset(doh_k12_2013, (doh_k12_2013$School.Code %in% doh_k12_2012$School.Code == F) & (doh_k12_2013$School.Code %in% doh_k12_2011$School.Code == F))

#How many of the unique schools are in King County?
summary(schoolcode_2012_unique$County == 'KING')
summary(schoolcode_2013_unique$County == 'KING')
summary(schoolcode_2011_unique$School.County == 'KING')

```
The 2012 data set is missing address data, but there are only 31 unique school codes in this data set, so there are only 31 missing addresses.

Going to rename the 2011 columns.



```{r rename columns}
colnames_2011 = c('year','school_code','school_name','school_type','school_street','school_city','school_state','school_zip','school_county','school_district','district_code','grade_levels','reported','enrolled','exempt','percent_exempt','medical_exempt','percent_medical_exempt','personal_exempt','percent_personal_exempt','religious_exempt','percent_religious_exempt','exempt_DTTd','exempt_pertussis','exempt_polio','exempt_measles','exempt_mumps','exempt_rubella','exempt_hepB','exempt_varicella')

colnames(doh_k12_2011) <- colnames_2011

colnames_2012 = c('school_code','school_name','school_type','school_district','school_county','reported','grade_levels','enrolled','exempt','medical_exempt','personal_exempt','religious_exempt','religious_member_exempt','exempt_DTTd','exempt_pertussis','exempt_polio','exempt_MMR','exempt_hepB','exempt_varicella','year')

colnames(doh_k12_2012) <- colnames_2012


```
The 2011 data set contains a field for each component of MMR.  I suspect these are all the same value since I'm not aware of administering MMR components seperately as a common practice.  Are these the same?  If so, I'm going to combine them into just MMR.

```{r more audit}
summary(doh_k12_2011$exempt_measles == doh_k12_2011$exempt_mumps)
summary(doh_k12_2011$exempt_measles == doh_k12_2011$exempt_rubella)
summary(doh_k12_2011$exempt_mumps == doh_k12_2011$exempt_rubella)

```
Hmm, it looks like the values differ in some instances, let's inspect that a bit.

```{r inspect 2011 MMR}
summary(doh_k12_2011$exempt_measles)
summary(doh_k12_2011$exempt_mumps)
summary(doh_k12_2011$exempt_rubella)

reported_measles = doh_k12_2011$exempt_measles[doh_k12_2011$reported == 'Yes']
reported_mumps = doh_k12_2011$exempt_mumps[doh_k12_2011$reported == 'Yes']
reported_rubella = doh_k12_2011$exempt_rubella[doh_k12_2011$reported == 'Yes']

summary(reported_measles - reported_rubella)
summary(reported_measles - reported_mumps)
summary(reported_mumps - reported_rubella)
doh_k12_2011[max(reported_measles-reported_rubella),]
```
I don't understand some of the values the summaries are giving.  It looks like in most or all instances that M, M, and R are the same.  I'm going to use measles as MMR.  I will renamed the column and drop the other two.

```{r 2011 drop and rename}
#drop mumps and rubella
doh_k12_2011$exempt_mumps <- NULL
doh_k12_2011$exempt_rubella <- NULL
colnames(doh_k12_2011)
#rename measles to MMR
names(doh_k12_2011)[names(doh_k12_2011) == 'exempt_measles'] <- 'exempt_MMR'
```

```{r align data to 2011 part 2}

```

