---
title: "Exploration of WA DOH School Vaccine Exemption Data for 2011-2013 School Year"
author: "Andrew Thomas Bauman"
date: "Saturday, March 14, 2015"
output: html_document
---
#Introduction#

Recent news media coverage and my own personal interest inspired me to explore a school vaccination data set for WA state.  WA DOH employees generously assembled 3 data sets for my project for school years 2011-2012, 2012-2013, and 2013-2014.  The 2011-2012 set is the most comprehensive in terms of school covered and relevant fields  Each data set contains an observation about a school.  The 3 data sets were bound into one data set, then explored.  

The initial data and cleaning/assembly of the combined data frame can be found here:
[githubrepo](https://github.com/baumanab/EDA_R_Udacity/tree/master/EDA_R_FinalProject)

The current state is a rough approach and far from perfect.  I plan to revisit this as I discover additional elements that need cleaning.  I am currently working on a more readable and organized version of the data wrangling which involves piping/chaining the code together, so that changes are easy to make and push to the .rds file called as data for this project.

**Disclaimer:**
While I am a trained scientist, I am not an expert statistician or programmer.  This is a student project.  My data cleaning and wrangling is not perfect.  As such, please exercise caution and good judgement regarding my observations and conclusions.  **Feedback on any aspect of this project is encouraged and most welcome.**

#Prepare Environment and Load Data#

```{r working directory, .RData I/O}
setwd("Udacity//dataAnalysisR/EDA_R_Udacity/EDA_R_FinalProject/")
save.image("project_pause.RData")
load("project_pause.RData")

```

```{r data load}
#load current rds
vacc <- readRDS('data/WA_DOH_Combined.rds')
```


```{r library load}
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(GGally)
library(reshape2)
library(tidyr)

```

#Exploratory Data Analysis#

##Initial Survey##

```{r summary, structure, names}
str(vacc)
summary(vacc)
names(vacc)

```
###Who is and is not reporting###
Many schools have not been reporting the vaccination status of their students.  Non-reporting is responsible for many of the Na values in this data set.  Who is and is not reporting?  Is this changing from year to year?

```{r reported yes VS no}
#counts of reported
table(vacc$reported)
#counts of repored for each year
with(vacc,table(school_year, reported))[,2:3]
#counts of reported for each school type
with(vacc,table(school_type, reported))[,2:3]
#counts of reported for each school type for each school year
with(vacc,table(school_type, reported, school_year))
#percent reported for each school type
prop.table(with(vacc,table(school_type, reported)),1)[,2:3]*100
#percent reported for each school type for each year
prop.table(with(vacc,table(school_type, reported,school_year == "2011")),c(1,3))[,2:3,2]*100
prop.table(with(vacc,table(school_type, reported,school_year == "2012")),c(1,3))[,2:3,2]*100
prop.table(with(vacc,table(school_type, reported,school_year == "2013")),c(1,3))[,2:3,2]*100

```
The 2011 data set has the most not reported.  The 2012 data set has 0 not reported.  This seems unusual given the number of not reported in the bracketing school years.  I wonder if the data provided in 2012 was only from schools that reported.  I do note that the 2012 data set has the most amount of schools as well.  Interesting, I will follow up on this.  2013 has 302 schools not reporting.  The data set actually didn't contain this information, and I surmised it for Na values in other columns (see data wrangling RMD).  Several news sources have reported that ~300 schools are failing to report.  That doesn't assure the accuracy of my calculation, but it is consistent.

```{r alter vacc}
#subset on reported == "Yes"
vaccReported <- subset(vacc, vacc$reported == "Yes")
names(vaccReported)
#create column for nonmedical_exempt
vaccReported$nonmedical_exempt <- vaccReported$religious_exempt + vaccReported$personal_exempt



```


```{r distributions}
#explore total exemptions
summary(vaccReported$total_exemptions)
by(vaccReported$total_exemptions, vaccReported$school_year,summary)
#total exempt
ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = 5,  color = 'black',fill = '#F79420') +
  scale_x_continuous(limits = c(0,250), breaks = seq(0, 250, 25))

#total exempt by year
ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = 5,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_continuous(limits = c(0,250), breaks = seq(0, 250, 25))

#log scale (longtail data)
ggplot(aes(x = total_exemptions), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(Total Exemptions)")

ggplot(aes(x = total_exemptions), data = subset(vaccReported, total_exemptions >0)) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = 'red') +
  scale_x_log10() +
  xlab("Log10(Total Exemptions)")

#explore medical exemptions
summary(vaccReported$medical_exempt)
by(vaccReported$medical_exempt, vaccReported$school_year,summary)
#medical exempt
ggplot(aes(x = medical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(medical_exemptions)")

#explore non-medical exemptions
summary(vaccReported$nonmedical_exempt)
by(vaccReported$nonmedical_exempt, vaccReported$school_year,summary)
#non-medical exempt
ggplot(aes(x = nonmedical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(nonMedical_exemptions)")

#normalize to per 1000 students

per1k_total_enrolled <- sum(vaccReported$enrolled)/1000

per1k_2011 <- sum(vaccReported$enrolled[vaccReported$school_year == "2011"])/1000
per1k_2012 <- sum(vaccReported$enrolled[vaccReported$school_year == "2012"])/1000
per1k_2013 <- sum(vaccReported$enrolled[vaccReported$school_year == "2013"])/1000

#explore non-medical exemptions
summary(vaccReported$nonmedical_exempt)
by(vaccReported$nonmedical_exempt, vaccReported$school_year,summary)
#non-medical exempt
ggplot(aes(x = nonmedical_exempt), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'black',fill = '#F79420') +
  facet_wrap(~school_year) +
  scale_x_log10() +
  xlab("Log10(nonMedical_exemptions)")

ggplot(aes(x = (nonmedical_exempt/enrolled) *100), data = vaccReported) + 
  geom_histogram(binwidth = .1,  color = 'blue',fill = 'red') +
  facet_wrap(~school_county) +
  scale_x_log10() +
  xlab("Log10(nonMedical_exemptions)")

ggplot(aes(x = percent_exempt_MMR), data = vaccReported) + 
  geom_histogram(binwidth = 1,  color = 'blue',fill = 'red') +
  #facet_wrap(~school_county) +
  #scale_x_log10()

ggplot(aes(x = percent_exempt_MMR), data = vaccReported) + 
  geom_histogram(binwidth = .2,  color = 'blue',fill = 'red') +
  #facet_wrap(~school_county) +
  scale_x_log10() 


ggplot(aes(x = percent_exempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

ggplot(aes(x = percent_exempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .1, aes(color = school_county)) +
  facet_wrap(~school_year) +
  scale_x_log10()

ggplot(aes(x = percent_exempt, y = ..count../sum(..count..)), data = vaccReported) +
  geom_freqpoly(binwidth = .5, aes(color = school_year)) +
  facet_wrap(~school_county) +
  scale_x_log10()

```
```{r }

gg <- subset(vaccReported, school_county == "KING" | school_county ==  "PIERCE")
ggplot(aes(x = percent_exempt, y = school_county), data = gg) +
  geom_point(alpha = .5, position = position_jitter(width = 0.4), aes(color = percent_exempt_MMR, size = enrolled)) +
facet_wrap(~school_year) +
  #scale_x_log10() +



ggplot(aes(y = percent_exempt, x = school_county), data = vaccReported) +
  geom_point(alpha = .25, position = position_jitter(width = 0.4), aes(color = school_year))




alpha = .25, position = position_jitter(h = 0)


#group by district and scatterplot

#group by county and scatterplot

#do facets by county with something related to year

#do something with districts within the plot for county

names(vaccReported)
unique(vaccReported$school_county)
unique(vaccReported$school_district)
```

